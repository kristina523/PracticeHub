generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ПЕРВОЕ: определите все enum ДО их использования
enum PracticeType {
  EDUCATIONAL   
  PRODUCTION     
  INTERNSHIP     
}

enum PracticeStatus {
  PENDING        
  ACTIVE      
  COMPLETED      
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum InstitutionType {
  COLLEGE      
  UNIVERSITY     
}

enum UserRole {
  ADMIN
  TEACHER
  STUDENT
}

// ВТОРОЕ: определите модель Institution ДО модели Student
model Institution {
  id          String    @id @default(uuid())
  name        String    
  type        InstitutionType
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  students    Student[]
}

// ТРЕТЬЕ: теперь можно использовать Institution в Student
model Student {
  id                String         @id @default(uuid())
  lastName          String        
  firstName         String        
  middleName        String?    
  practiceType      PracticeType
  institutionId     String
  institutionName   String        
  course            Int     
  email             String?
  phone             String?
  telegramId        String?
  startDate         DateTime
  endDate           DateTime
  status            PracticeStatus 
  supervisor        String?     
  notes             String?      
  privacyAccepted   Boolean        @default(false)
  privacyAcceptedAt DateTime?
  
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  institution       Institution    @relation(fields: [institutionId], references: [id])
}

model Admin {
  id          String    @id @default(uuid())
  username    String    @unique
  email       String    @unique
  password    String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Teacher {
  id          String    @id @default(uuid())
  username    String    @unique
  email       String    @unique
  password    String
  firstName   String
  lastName    String
  middleName  String?
  phone       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model StudentUser {
  id                  String               @id @default(uuid())
  username            String               @unique
  email               String               @unique
  password            String
  studentId           String?              @unique
  telegramId          String?              @unique
  privacyAccepted     Boolean              @default(false)
  privacyAcceptedAt   DateTime?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  
  applications        PracticeApplication[]
}

model PracticeApplication {
  id                String            @id @default(uuid())
  studentUserId     String
  lastName          String
  firstName         String
  middleName        String?
  practiceType      PracticeType
  institutionName   String
  course            Int
  email             String?
  phone             String?
  telegramId        String?
  startDate         DateTime
  endDate           DateTime
  status            ApplicationStatus @default(PENDING)
  rejectionReason   String?
  approvedBy        String? // ID администратора или преподавателя
  notes             String?
  privacyAccepted   Boolean           @default(false)
  privacyAcceptedAt DateTime?
  
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  
  studentUser       StudentUser       @relation(fields: [studentUserId], references: [id], onDelete: Cascade)
}